"use strict";System.register([],function(t,e){return{setters:[],execute:function(){System.register(["../services/CalculationService","../models/DefaultCalculation","../views/CalculationView","../helpers/Bind","../models/ListCalculations","../models/Display","../views/DisplayView","../helpers/CalculationHelper","../models/Calculation"],function(t,e){var i,n,l,a,s,o,c,u,r,d,h,f;return{setters:[function(t){i=t.CalculationService},function(t){n=t.DefaultCalculation},function(t){l=t.CalculationView},function(t){a=t.Bind},function(t){s=t.ListCalculations},function(t){o=t.Display},function(t){c=t.DisplayView},function(t){u=t.CalculationHelper},function(t){r=t.Calculation}],execute:function(){d=function(){function n(t,e){for(var i=0;i<e.length;i++){var n=e[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}return function(t,e,i){return e&&n(t.prototype,e),i&&n(t,i),t}}(),h=function(){function e(){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,e);var t=document.querySelector.bind(document);this._answered=!1,this._calculatorBody=t("[data-calc]"),this._service=new i,this._calculationModel=new n,this._calculationView=new l(t("[data-calc-history]")),this._listCalculation=new a(new s,this._calculationView,"add","remove","sortByDate"),this._listCalculationDirection=!0,this._display=new a(new o(this._calculationModel.expression,this._calculationModel.result),new c(t("[data-display]")),"addToLast","addToCurrent"),this._init()}return d(e,[{key:"_init",value:function(){var i=this;this._service.requestLocalCalculations().then(function(t){return t.forEach(function(t){return i._listCalculation.add(t)})}),document.addEventListener("keydown",function(t){var e=u.getCalculatorKeyByCode(t.keyCode);e&&i.processKey(e)})}},{key:"importCalculations",value:function(){var i=this;this._service.requestCalculations().then(function(t){return t.filter(function(e){return!i._listCalculation.calculations.some(function(t){return e.isEquals(t)})})}).then(function(t){return t.forEach(function(t){return i._listCalculation.add(t)})})}},{key:"resetFields",value:function(){this._calculationModel.expression="",this._calculationModel.result="",this._answered=!1,this._display.addToLast(this._calculationModel.expression),this._display.addToCurrent(this._calculationModel.result)}},{key:"incrementExpression",value:function(t){this._calculationModel.expression+=t,this._display.addToCurrent(this._calculationModel.expression)}},{key:"defineResults",value:function(t){this._calculationModel.result=t}},{key:"calculate",value:function(){for(var t=u.splitExpression(this._calculationModel.expression),e=u.getOperators(),i=Array.from(t),n=0;n<e.length;n++)for(;i.includes(e[n]);){var l=i.indexOf(e[n]);"/"===e[n]?i[l-1]=parseFloat(i[l-1])/parseFloat(i[l+1]):"x"===e[n]?i[l-1]=parseFloat(i[l-1])*parseFloat(i[l+1]):"-"===e[n]?i[l-1]=parseFloat(i[l-1])-parseFloat(i[l+1]):"+"===e[n]&&(i[l-1]=parseFloat(i[l-1])+parseFloat(i[l+1])),i.splice(l,2)}return i[0]}},{key:"processKey",value:function(t){if(this._answered&&u.isNumber(t)&&(this._calculationModel.expression=""),this._answered=!1,(!u.isEquals(t)||this._calculationModel.expression)&&u.validade(t,this._calculationModel.expression))return u.isEquals(t)?this.concludeCalculation():u.isCleaner(t)?this.resetFields():void this.incrementExpression(t)}},{key:"saveCalculation",value:function(){var t=this,e=new r(new Date,this._calculationModel.expression,this._calculationModel.result);this._service.postCalculation(e).then(function(){return t._listCalculation.add(e)}),this._display.addToLast(this._calculationModel.expression),this._display.addToCurrent(this._calculationModel.result),this._answered=!0,this._calculationModel.expression=this._calculationModel.result=e.result.toString()}},{key:"concludeCalculation",value:function(){var t=this.calculate();this.defineResults(t),this.saveCalculation()}},{key:"deleteCalculationHistory",value:function(){var t=this;this._service.clearCalculations().then(function(){return t._listCalculation.remove()})}},{key:"orderCalculationHistory",value:function(){this._listCalculation.sortByDate(this._listCalculationDirection),this._listCalculationDirection=!this._listCalculationDirection}},{key:"toggleHistoryMode",value:function(){this._calculationView.toggleHistoryMode(this._calculatorBody)}},{key:"expression",get:function(){return this._calculationModel.expression}},{key:"result",get:function(){return this._calculationModel.result}}]),e}(),f=new h,t("currentInstance",function(){return f})}}})}}});
//# sourceMappingURL=CalculationController.js.map
