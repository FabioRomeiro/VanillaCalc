{"version":3,"sources":["services/CalculationService.js"],"names":["_createClass","defineProperties","target","props","i","length","descriptor","enumerable","configurable","writable","Object","defineProperty","key","Constructor","protoProps","staticProps","prototype","_classCallCheck","instance","TypeError","CalculationService","this","_http","HttpService","value","ConnectionFactory","getConnection","then","connection","CalculationDao","dao","listAll","Promise","all","requestOldCalculations","requestYesterdaysCalculations","requestTodaysCalculations","periods","reduce","calculations","array","concat","catch","err","Error","_this","resolve","reject","get","map","item","Calculation","Date","date","expression","result","_this2","_this3","calculation","add","clearAll"],"mappings":"AAAA,aAEA,IAAIA,aAAe,WAAc,SAASC,EAAiBC,EAAQC,GAAS,IAAK,IAAIC,EAAI,EAAGA,EAAID,EAAME,OAAQD,IAAK,CAAE,IAAIE,EAAaH,EAAMC,GAAIE,EAAWC,WAAaD,EAAWC,aAAc,EAAOD,EAAWE,cAAe,EAAU,UAAWF,IAAYA,EAAWG,UAAW,GAAMC,OAAOC,eAAeT,EAAQI,EAAWM,IAAKN,IAAiB,OAAO,SAAUO,EAAaC,EAAYC,GAAiJ,OAA9HD,GAAYb,EAAiBY,EAAYG,UAAWF,GAAiBC,GAAad,EAAiBY,EAAaE,GAAqBF,GAA7gB,GAEnB,SAASI,gBAAgBC,EAAUL,GAAe,KAAMK,aAAoBL,GAAgB,MAAM,IAAIM,UAAU,qCAEhH,IAAIC,mBAAqB,WACrB,SAASA,IACLH,gBAAgBI,KAAMD,GAEtBC,KAAKC,MAAQ,IAAIC,YAyGrB,OAtGAvB,aAAaoB,EAAoB,CAAC,CAC9BR,IAAK,2BACLY,MAAO,WACH,OAAOC,kBAAkBC,gBAAgBC,KAAK,SAAUC,GACpD,OAAO,IAAIC,eAAeD,KAC3BD,KAAK,SAAUG,GACd,OAAOA,EAAIC,cAGpB,CACCnB,IAAK,sBACLY,MAAO,WAEH,OAAOQ,QAAQC,IAAI,CAACZ,KAAKa,yBAA0Bb,KAAKc,gCAAiCd,KAAKe,8BAA8BT,KAAK,SAAUU,GACvI,OAAOA,EAAQC,OAAO,SAAUC,EAAcC,GAC1C,OAAOD,EAAaE,OAAOD,IAC5B,MACJE,MAAM,SAAUC,GACf,MAAM,IAAIC,MAAMD,OAGzB,CACC/B,IAAK,4BACLY,MAAO,WACH,IAAIqB,EAAQxB,KAEZ,OAAO,IAAIW,QAAQ,SAAUc,EAASC,GAElCF,EAAMvB,MAAM0B,IAAI,mCAAmCrB,KAAK,SAAUY,GAC9D,OAAOO,EAAQP,EAAaU,IAAI,SAAUC,GACtC,OAAO,IAAIC,YAAY,IAAIC,KAAKF,EAAKG,MAAOH,EAAKI,WAAYJ,EAAKK,aAEvEb,MAAM,SAAUC,GACf,OAAOI,EAAOJ,SAI3B,CACC/B,IAAK,gCACLY,MAAO,WACH,IAAIgC,EAASnC,KAEb,OAAO,IAAIW,QAAQ,SAAUc,EAASC,GAElCS,EAAOlC,MAAM0B,IAAI,yCAAyCrB,KAAK,SAAUY,GACrE,OAAOO,EAAQP,EAAaU,IAAI,SAAUC,GACtC,OAAO,IAAIC,YAAY,IAAIC,KAAKF,EAAKG,MAAOH,EAAKI,WAAYJ,EAAKK,aAEvEb,MAAM,SAAUC,GACf,OAAOI,EAAOJ,SAI3B,CACC/B,IAAK,yBACLY,MAAO,WACH,IAAIiC,EAASpC,KAEb,OAAO,IAAIW,QAAQ,SAAUc,EAASC,GAElCU,EAAOnC,MAAM0B,IAAI,mCAAmCrB,KAAK,SAAUY,GAC/D,OAAOO,EAAQP,EAAaU,IAAI,SAAUC,GACtC,OAAO,IAAIC,YAAY,IAAIC,KAAKF,EAAKG,MAAOH,EAAKI,WAAYJ,EAAKK,aAEvEb,MAAM,SAAUC,GACf,OAAOI,EAAOJ,SAI3B,CACC/B,IAAK,kBACLY,MAAO,SAAyBkC,GAE5B,OAAOjC,kBAAkBC,gBAAgBC,KAAK,SAAUC,GACpD,OAAO,IAAIC,eAAeD,KAC3BD,KAAK,SAAUG,GACd,OAAOA,EAAI6B,IAAID,OAexB,CACC9C,IAAK,oBACLY,MAAO,WACH,OAAOC,kBAAkBC,gBAAgBC,KAAK,SAAUC,GACpD,OAAO,IAAIC,eAAeD,KAC3BD,KAAK,SAAUG,GACd,OAAOA,EAAI8B,iBAKhBxC,EA7Gc","file":"CalculationService.js","sourcesContent":["'use strict';\n\nvar _createClass = function () { function defineProperties(target, props) { for (var i = 0; i < props.length; i++) { var descriptor = props[i]; descriptor.enumerable = descriptor.enumerable || false; descriptor.configurable = true; if (\"value\" in descriptor) descriptor.writable = true; Object.defineProperty(target, descriptor.key, descriptor); } } return function (Constructor, protoProps, staticProps) { if (protoProps) defineProperties(Constructor.prototype, protoProps); if (staticProps) defineProperties(Constructor, staticProps); return Constructor; }; }();\n\nfunction _classCallCheck(instance, Constructor) { if (!(instance instanceof Constructor)) { throw new TypeError(\"Cannot call a class as a function\"); } }\n\nvar CalculationService = function () {\n    function CalculationService() {\n        _classCallCheck(this, CalculationService);\n\n        this._http = new HttpService();\n    }\n\n    _createClass(CalculationService, [{\n        key: 'requestLocalCalculations',\n        value: function requestLocalCalculations() {\n            return ConnectionFactory.getConnection().then(function (connection) {\n                return new CalculationDao(connection);\n            }).then(function (dao) {\n                return dao.listAll();\n            });\n        }\n    }, {\n        key: 'requestCalculations',\n        value: function requestCalculations() {\n\n            return Promise.all([this.requestOldCalculations(), this.requestYesterdaysCalculations(), this.requestTodaysCalculations()]).then(function (periods) {\n                return periods.reduce(function (calculations, array) {\n                    return calculations.concat(array);\n                }, []);\n            }).catch(function (err) {\n                throw new Error(err);\n            });\n        }\n    }, {\n        key: 'requestTodaysCalculations',\n        value: function requestTodaysCalculations() {\n            var _this = this;\n\n            return new Promise(function (resolve, reject) {\n\n                _this._http.get('http://localhost:9003/calcs/day').then(function (calculations) {\n                    return resolve(calculations.map(function (item) {\n                        return new Calculation(new Date(item.date), item.expression, item.result);\n                    }));\n                }).catch(function (err) {\n                    return reject(err);\n                });\n            });\n        }\n    }, {\n        key: 'requestYesterdaysCalculations',\n        value: function requestYesterdaysCalculations() {\n            var _this2 = this;\n\n            return new Promise(function (resolve, reject) {\n\n                _this2._http.get('http://localhost:9003/calcs/yesterday').then(function (calculations) {\n                    return resolve(calculations.map(function (item) {\n                        return new Calculation(new Date(item.date), item.expression, item.result);\n                    }));\n                }).catch(function (err) {\n                    return reject(err);\n                });\n            });\n        }\n    }, {\n        key: 'requestOldCalculations',\n        value: function requestOldCalculations() {\n            var _this3 = this;\n\n            return new Promise(function (resolve, reject) {\n\n                _this3._http.get('http://localhost:9003/calcs/old').then(function (calculations) {\n                    return resolve(calculations.map(function (item) {\n                        return new Calculation(new Date(item.date), item.expression, item.result);\n                    }));\n                }).catch(function (err) {\n                    return reject(err);\n                });\n            });\n        }\n    }, {\n        key: 'postCalculation',\n        value: function postCalculation(calculation) {\n\n            return ConnectionFactory.getConnection().then(function (connection) {\n                return new CalculationDao(connection);\n            }).then(function (dao) {\n                return dao.add(calculation);\n            })\n            /*.then(() => {\n                 let content = {\n                    date: calculation.date,\n                    expression: calculation.expression,\n                    result: calculation.result\n                };\n                 this._http\n                    .post('http://localhost:9003/calc', content)                    \n                    .catch(err => {\n                        throw new Error(err); \n                    });\n            })*/;\n        }\n    }, {\n        key: 'clearCalculations',\n        value: function clearCalculations() {\n            return ConnectionFactory.getConnection().then(function (connection) {\n                return new CalculationDao(connection);\n            }).then(function (dao) {\n                return dao.clearAll();\n            });\n        }\n    }]);\n\n    return CalculationService;\n}();"]}