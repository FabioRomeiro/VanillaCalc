{"version":3,"sources":["services/CalculationService.js"],"names":["System","register","_export2","_context2","setters","execute","_export","_context","HttpService","ConnectionFactory","CalculationDao","Calculation","_createClass","CalculationService","_HttpService","_ConnectionFactory","_daoCalculationDao","_modelsCalculation","defineProperties","target","props","i","length","descriptor","enumerable","configurable","writable","Object","defineProperty","key","Constructor","protoProps","staticProps","prototype","instance","TypeError","_classCallCheck","this","_http","value","getConnection","then","connection","dao","listAll","Promise","all","requestOldCalculations","requestYesterdaysCalculations","requestTodaysCalculations","periods","reduce","calculations","array","concat","catch","err","Error","_this","resolve","reject","get","map","item","Date","date","expression","result","_this2","_this3","calculation","_this4","add","content","post","clearAll"],"mappings":"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","file":"CalculationService.js","sourcesContent":["'use strict';\n\nSystem.register([], function (_export2, _context2) {\n    \"use strict\";\n\n    return {\n        setters: [],\n        execute: function () {\n            System.register(['./HttpService', './ConnectionFactory', '../dao/CalculationDao', '../models/Calculation'], function (_export, _context) {\n                \"use strict\";\n\n                var HttpService, ConnectionFactory, CalculationDao, Calculation, _createClass, CalculationService;\n\n                function _classCallCheck(instance, Constructor) {\n                    if (!(instance instanceof Constructor)) {\n                        throw new TypeError(\"Cannot call a class as a function\");\n                    }\n                }\n\n                return {\n                    setters: [function (_HttpService) {\n                        HttpService = _HttpService.HttpService;\n                    }, function (_ConnectionFactory) {\n                        ConnectionFactory = _ConnectionFactory.ConnectionFactory;\n                    }, function (_daoCalculationDao) {\n                        CalculationDao = _daoCalculationDao.CalculationDao;\n                    }, function (_modelsCalculation) {\n                        Calculation = _modelsCalculation.Calculation;\n                    }],\n                    execute: function () {\n                        _createClass = function () {\n                            function defineProperties(target, props) {\n                                for (var i = 0; i < props.length; i++) {\n                                    var descriptor = props[i];\n                                    descriptor.enumerable = descriptor.enumerable || false;\n                                    descriptor.configurable = true;\n                                    if (\"value\" in descriptor) descriptor.writable = true;\n                                    Object.defineProperty(target, descriptor.key, descriptor);\n                                }\n                            }\n\n                            return function (Constructor, protoProps, staticProps) {\n                                if (protoProps) defineProperties(Constructor.prototype, protoProps);\n                                if (staticProps) defineProperties(Constructor, staticProps);\n                                return Constructor;\n                            };\n                        }();\n\n                        _export('CalculationService', CalculationService = function () {\n                            function CalculationService() {\n                                _classCallCheck(this, CalculationService);\n\n                                this._http = new HttpService();\n                            }\n\n                            _createClass(CalculationService, [{\n                                key: 'requestLocalCalculations',\n                                value: function requestLocalCalculations() {\n                                    return ConnectionFactory.getConnection().then(function (connection) {\n                                        return new CalculationDao(connection);\n                                    }).then(function (dao) {\n                                        return dao.listAll();\n                                    });\n                                }\n                            }, {\n                                key: 'requestCalculations',\n                                value: function requestCalculations() {\n\n                                    return Promise.all([this.requestOldCalculations(), this.requestYesterdaysCalculations(), this.requestTodaysCalculations()]).then(function (periods) {\n                                        return periods.reduce(function (calculations, array) {\n                                            return calculations.concat(array);\n                                        }, []);\n                                    }).catch(function (err) {\n                                        throw new Error(err);\n                                    });\n                                }\n                            }, {\n                                key: 'requestTodaysCalculations',\n                                value: function requestTodaysCalculations() {\n                                    var _this = this;\n\n                                    return new Promise(function (resolve, reject) {\n\n                                        _this._http.get('http://localhost:9003/calcs/day').then(function (calculations) {\n                                            return resolve(calculations.map(function (item) {\n                                                return new Calculation(new Date(item.date), item.expression, item.result);\n                                            }));\n                                        }).catch(function (err) {\n                                            return reject(err);\n                                        });\n                                    });\n                                }\n                            }, {\n                                key: 'requestYesterdaysCalculations',\n                                value: function requestYesterdaysCalculations() {\n                                    var _this2 = this;\n\n                                    return new Promise(function (resolve, reject) {\n\n                                        _this2._http.get('http://localhost:9003/calcs/yesterday').then(function (calculations) {\n                                            return resolve(calculations.map(function (item) {\n                                                return new Calculation(new Date(item.date), item.expression, item.result);\n                                            }));\n                                        }).catch(function (err) {\n                                            return reject(err);\n                                        });\n                                    });\n                                }\n                            }, {\n                                key: 'requestOldCalculations',\n                                value: function requestOldCalculations() {\n                                    var _this3 = this;\n\n                                    return new Promise(function (resolve, reject) {\n\n                                        _this3._http.get('http://localhost:9003/calcs/old').then(function (calculations) {\n                                            return resolve(calculations.map(function (item) {\n                                                return new Calculation(new Date(item.date), item.expression, item.result);\n                                            }));\n                                        }).catch(function (err) {\n                                            return reject(err);\n                                        });\n                                    });\n                                }\n                            }, {\n                                key: 'postCalculation',\n                                value: function postCalculation(calculation) {\n                                    var _this4 = this;\n\n                                    return ConnectionFactory.getConnection().then(function (connection) {\n                                        return new CalculationDao(connection);\n                                    }).then(function (dao) {\n                                        return dao.add(calculation);\n                                    }).then(function () {\n\n                                        var content = {\n                                            date: calculation.date,\n                                            expression: calculation.expression,\n                                            result: calculation.result\n                                        };\n\n                                        _this4._http.post('http://localhost:9003/calc', content).catch(function (err) {\n                                            throw new Error(err);\n                                        });\n                                    });\n                                }\n                            }, {\n                                key: 'clearCalculations',\n                                value: function clearCalculations() {\n                                    return ConnectionFactory.getConnection().then(function (connection) {\n                                        return new CalculationDao(connection);\n                                    }).then(function (dao) {\n                                        return dao.clearAll();\n                                    });\n                                }\n                            }]);\n\n                            return CalculationService;\n                        }());\n\n                        _export('CalculationService', CalculationService);\n                    }\n                };\n            });\n        }\n    };\n});"]}