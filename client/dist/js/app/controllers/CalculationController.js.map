{"version":3,"sources":["controllers/CalculationController.js"],"names":["_createClass","defineProperties","target","props","i","length","descriptor","enumerable","configurable","writable","Object","defineProperty","key","Constructor","protoProps","staticProps","prototype","_classCallCheck","instance","TypeError","CalculationController","this","$","document","querySelector","bind","_answered","_calculatorBody","_service","CalculationService","_calculationModel","DefaultCalculation","_calculationView","CalculationView","_listCalculation","Bind","ListCalculations","_listCalculationDirection","_display","Display","expression","result","DisplayView","_init","value","_this","requestLocalCalculations","then","calculations","forEach","calculation","add","addEventListener","e","CalculationHelper","getCalculatorKeyByCode","keyCode","processKey","_this2","requestCalculations","allCalculations","filter","some","existentCalculation","isEquals","newCalculations","newCalculation","addToLast","addToCurrent","operation","splitExpression","operators","getOperators","res","Array","from","includes","operatorIndex","indexOf","parseFloat","splice","isNumber","validade","concludeCalculation","isCleaner","resetFields","incrementExpression","_this3","Calculation","Date","postCalculation","toString","answer","calculate","defineResults","saveCalculation","_this4","clearCalculations","remove","sortByDate","toggleHistoryMode","get"],"mappings":"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","file":"CalculationController.js","sourcesContent":["'use strict';\n\nvar _createClass = function () { function defineProperties(target, props) { for (var i = 0; i < props.length; i++) { var descriptor = props[i]; descriptor.enumerable = descriptor.enumerable || false; descriptor.configurable = true; if (\"value\" in descriptor) descriptor.writable = true; Object.defineProperty(target, descriptor.key, descriptor); } } return function (Constructor, protoProps, staticProps) { if (protoProps) defineProperties(Constructor.prototype, protoProps); if (staticProps) defineProperties(Constructor, staticProps); return Constructor; }; }();\n\nfunction _classCallCheck(instance, Constructor) { if (!(instance instanceof Constructor)) { throw new TypeError(\"Cannot call a class as a function\"); } }\n\nvar CalculationController = function () {\n  function CalculationController() {\n    _classCallCheck(this, CalculationController);\n\n    var $ = document.querySelector.bind(document);\n    this._answered = false;\n    this._calculatorBody = $('[data-calc]');\n\n    this._service = new CalculationService();\n    this._calculationModel = new DefaultCalculation();\n    this._calculationView = new CalculationView($('[data-calc-history]'));\n\n    this._listCalculation = new Bind(new ListCalculations(), this._calculationView, 'add', 'remove', 'sortByDate');\n    this._listCalculationDirection = true;\n\n    this._display = new Bind(new Display(this._calculationModel.expression, this._calculationModel.result), new DisplayView($('[data-display]')), 'addToLast', 'addToCurrent');\n\n    this._init();\n  }\n\n  _createClass(CalculationController, [{\n    key: '_init',\n    value: function _init() {\n      var _this = this;\n\n      this._service.requestLocalCalculations().then(function (calculations) {\n        return calculations.forEach(function (calculation) {\n          return _this._listCalculation.add(calculation);\n        });\n      });\n\n      document.addEventListener('keydown', function (e) {\n        var key = CalculationHelper.getCalculatorKeyByCode(e.keyCode);\n        if (key) _this.processKey(key);\n      });\n    }\n  }, {\n    key: 'importCalculations',\n    value: function importCalculations() {\n      var _this2 = this;\n\n      this._service.requestCalculations().then(function (allCalculations) {\n        return allCalculations.filter(function (calculation) {\n          return !_this2._listCalculation.calculations.some(function (existentCalculation) {\n            return calculation.isEquals(existentCalculation);\n          });\n        });\n      }).then(function (newCalculations) {\n        return newCalculations.forEach(function (newCalculation) {\n          return _this2._listCalculation.add(newCalculation);\n        });\n      });\n    }\n  }, {\n    key: 'resetFields',\n    value: function resetFields() {\n      this._calculationModel.expression = '';\n      this._calculationModel.result = '';\n      this._answered = false;\n      this._display.addToLast(this._calculationModel.expression);\n      this._display.addToCurrent(this._calculationModel.result);\n    }\n  }, {\n    key: 'incrementExpression',\n    value: function incrementExpression(key) {\n      this._calculationModel.expression += key;\n      this._display.addToCurrent(this._calculationModel.expression);\n    }\n  }, {\n    key: 'defineResults',\n    value: function defineResults(result) {\n      this._calculationModel.result = result;\n    }\n  }, {\n    key: 'calculate',\n    value: function calculate() {\n      var operation = CalculationHelper.splitExpression(this._calculationModel.expression);\n      var operators = CalculationHelper.getOperators();\n      var res = Array.from(operation);\n      for (var i = 0; i < operators.length; i++) {\n        while (res.includes(operators[i])) {\n          var operatorIndex = res.indexOf(operators[i]);\n          if (operators[i] === '/') {\n            res[operatorIndex - 1] = parseFloat(res[operatorIndex - 1]) / parseFloat(res[operatorIndex + 1]);\n          } else if (operators[i] === 'x') {\n            res[operatorIndex - 1] = parseFloat(res[operatorIndex - 1]) * parseFloat(res[operatorIndex + 1]);\n          } else if (operators[i] === '-') {\n            res[operatorIndex - 1] = parseFloat(res[operatorIndex - 1]) - parseFloat(res[operatorIndex + 1]);\n          } else if (operators[i] === '+') {\n            res[operatorIndex - 1] = parseFloat(res[operatorIndex - 1]) + parseFloat(res[operatorIndex + 1]);\n          }\n          res.splice(operatorIndex, 2);\n        }\n      }\n\n      return res[0];\n    }\n  }, {\n    key: 'processKey',\n    value: function processKey(key) {\n\n      if (this._answered && CalculationHelper.isNumber(key)) this._calculationModel.expression = '';\n\n      this._answered = false;\n\n      if (CalculationHelper.isEquals(key) && !this._calculationModel.expression) return;\n\n      if (!CalculationHelper.validade(key, this._calculationModel.expression)) return;\n\n      if (CalculationHelper.isEquals(key)) {\n        return this.concludeCalculation();\n      }\n\n      if (CalculationHelper.isCleaner(key)) return this.resetFields();\n\n      this.incrementExpression(key);\n    }\n  }, {\n    key: 'saveCalculation',\n    value: function saveCalculation() {\n      var _this3 = this;\n\n      var calculation = new Calculation(new Date(), this._calculationModel.expression, this._calculationModel.result);\n\n      this._service.postCalculation(calculation).then(function () {\n        return _this3._listCalculation.add(calculation);\n      });\n\n      this._display.addToLast(this._calculationModel.expression);\n      this._display.addToCurrent(this._calculationModel.result);\n\n      this._answered = true;\n      this._calculationModel.expression = this._calculationModel.result = calculation.result.toString();\n    }\n  }, {\n    key: 'concludeCalculation',\n    value: function concludeCalculation() {\n\n      var answer = this.calculate();\n      this.defineResults(answer);\n      this.saveCalculation();\n    }\n  }, {\n    key: 'deleteCalculationHistory',\n    value: function deleteCalculationHistory() {\n      var _this4 = this;\n\n      this._service.clearCalculations().then(function () {\n        return _this4._listCalculation.remove();\n      });\n    }\n  }, {\n    key: 'orderCalculationHistory',\n    value: function orderCalculationHistory() {\n      this._listCalculation.sortByDate(this._listCalculationDirection);\n      this._listCalculationDirection = !this._listCalculationDirection;\n    }\n  }, {\n    key: 'toggleHistoryMode',\n    value: function toggleHistoryMode() {\n      this._calculationView.toggleHistoryMode(this._calculatorBody);\n    }\n  }, {\n    key: 'expression',\n    get: function get() {\n      return this._calculationModel.expression;\n    }\n  }, {\n    key: 'result',\n    get: function get() {\n      return this._calculationModel.result;\n    }\n  }]);\n\n  return CalculationController;\n}();"]}