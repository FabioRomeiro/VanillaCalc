var key,key_type,operation="",numbers=[],operators=["/","x","-","+"],raw_numbers=document.querySelectorAll("[data-type=number]");raw_numbers.forEach(function(e){numbers.push(e.getAttribute("name"))});var operators_key_map={"/":[111,191],x:[88,106],"-":[109,189],"+":[107,203],"=":[187,13],CE:[8]},numbers_key_map={".":[110,190,188]};function maping_numbers(){for(var e=[48,96],r=0;r<10;r++)numbers_key_map[r]=[e[0],e[1]],e[0]++,e[1]++}var answered=!1,answer=null,display={last_operation:document.querySelector("[data-display=last]"),current_operation:document.querySelector("[data-display=current]")},keys=document.querySelectorAll("[data-type]");function _key_is_enabled(e){return null===e.getAttribute("disabled")}function _type_is_operator(e){return"operator"===e}function clear(){answered=!1,answer=null,_update_display("current_operation",operation=""),_update_display("last_operation","")}function _update_display(e,r){display[e].textContent=r}function _is_operator(e){return operators.includes(e)}function _split_operation(e){for(var r=[],t=0,a=0;a<e.length;a++)_is_operator(e[a])&&0!==a&&(r.push(e.slice(t,a)),r.push(e[a]),t=a+1),a==e.length-1&&r.push(e.slice(t,e.length));return r}function valid_operation(e,r){return!(_is_operator(r)&&_is_operator(operation[operation.length-1])||!operation&&("/"===r||"x"===r)||"0"===r&&"/"===operation[operation.length-1])}function calculate(){for(var e=_split_operation(operation),r=Array.from(e),t=0;t<operators.length;t++)for(;r.includes(operators[t]);){var a=r.indexOf(operators[t]);"/"===operators[t]?r[a-1]=parseFloat(r[a-1])/parseFloat(r[a+1]):"x"===operators[t]?r[a-1]=parseFloat(r[a-1])*parseFloat(r[a+1]):"-"===operators[t]?r[a-1]=parseFloat(r[a-1])-parseFloat(r[a+1]):"+"===operators[t]&&(r[a-1]=parseFloat(r[a-1])+parseFloat(r[a+1])),r.splice(a,2)}return r}function process_digit(){if(key)if(answered&&_type_is_operator(key_type)&&(operation+=answer),valid_operation("default",key))if(answered&&(_update_display("last_operation",answer),answered=!1),"equals"===key_type){if(!operation&&answer)operation=answer+"x2";else if(!operation&&!answer)return;answer=calculate(operation),_update_display("last_operation",operation),_update_display("current_operation",answer),answered=!(operation="")}else"cleaner"===key_type?clear():_update_display("current_operation",operation+=key);else alert("Essa operação não é valida")}function _get_key_by_keycode(e,r){for(var t=Object.keys(e),a=Object.values(e),o=0;o<t.length;o++)if(a[o].includes(r))return t[o]}function _get_keytype_by_key(e){return"="===e?"equals":"CE"===e?"cleaner":operators.includes(e)?"operator":numbers.includes(e)?"number":void 0}maping_numbers(),document.addEventListener("keydown",function(e){key=_get_key_by_keycode(operators_key_map,e.keyCode)||_get_key_by_keycode(numbers_key_map,e.keyCode),key_type=_get_keytype_by_key(key),process_digit()}),keys.forEach(function(e){_key_is_enabled(e)&&e.addEventListener("click",function(){key=e.getAttribute("name"),key_type=e.getAttribute("data-type"),process_digit()})});